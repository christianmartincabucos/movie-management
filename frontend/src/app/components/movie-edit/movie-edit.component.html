<div class="container mx-auto p-4 max-w-2xl">
  <div class="mb-6">
    <h1 class="text-2xl font-bold">Edit Movie</h1>
  </div>
  
  @if (loading) {
    <div class="flex flex-col items-center justify-center p-8">
    <div class="w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"></div>
    <p class="mt-4">Loading movie data...</p>
    </div>
  } @else if (error) {
    <div class="bg-red-50 border border-red-200 p-4 rounded-md">
    <p class="text-red-600 mb-2">{{ error }}</p>
    <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" (click)="loadMovie()">Retry</button>
    </div>
  } @else {
    <form [formGroup]="movieForm" (ngSubmit)="onSubmit()">
    <div class="mb-4">
      <label for="title" class="block mb-1 font-medium">Title</label>
      <input 
      type="text" 
      id="title" 
      formControlName="title" 
      class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      [ngClass]="{'border-red-500 focus:ring-red-500': isFieldInvalid('title')}">
      @if (isFieldInvalid('title')) {
      <div class="text-red-500 text-sm mt-1">Title is required</div>
      }
    </div>
    
    <div class="mb-4">
      <label for="description" class="block mb-1 font-medium">Description</label>
      <textarea 
      id="description" 
      formControlName="description" 
      rows="5" 
      class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      [ngClass]="{'border-red-500 focus:ring-red-500': isFieldInvalid('description')}"></textarea>
      @if (isFieldInvalid('description')) {
      <div class="text-red-500 text-sm mt-1">Description is required</div>
      }
    </div>
    
    <div class="mb-4">
      <label for="date_added" class="block mb-1 font-medium">Date Added</label>
      <input 
      type="date" 
      id="date_added" 
      formControlName="date_added" 
      class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      [ngClass]="{'border-red-500 focus:ring-red-500': isFieldInvalid('date_added')}">
      @if (isFieldInvalid('date_added')) {
      <div class="text-red-500 text-sm mt-1">Date is required</div>
      }
    </div>
    
    <div class="mb-4">
      <label for="video_file" class="block mb-1 font-medium">Video File</label>
      <div class="mb-3" *ngIf="movie?.video_file">
      <p>Current video: <span class="font-semibold">{{ getVideoFileName() }}</span></p>
      <div class="mt-2 mb-4">
        <app-video-player [videoUrl]="getVideoUrl()" [showControls]="true" [height]="150"></app-video-player>
      </div>
      </div>
      
      <div class="mt-2">
      <input 
        type="file" 
        id="video_file" 
        (change)="onFileChange($event)" 
        accept="video/*"
        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
      <p class="text-sm text-gray-500 mt-1">Select a new video file to replace the current one (optional)</p>
      </div>
      
      @if (selectedFile) {
      <div class="mt-2 p-2 bg-gray-100 rounded">
        <p>Selected file: {{ selectedFile.name }} ({{ (selectedFile.size / 1048576).toFixed(2) }} MB)</p>
      </div>
      }
    </div>
    
    <div class="flex justify-between mt-6">
      <button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400" routerLink="/movies/{{movieId}}">Cancel</button>
      <button 
      type="submit" 
      class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed"
      [disabled]="movieForm.invalid || submitting">
      <span *ngIf="submitting">Saving...</span>
      <span *ngIf="!submitting">Save Changes</span>
      </button>
    </div>
    </form>
  }
</div>